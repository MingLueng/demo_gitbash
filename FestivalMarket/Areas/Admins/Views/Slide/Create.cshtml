
@{
    ViewBag.Title = "Thêm mới Banner";
    ViewBag.Title_back = "Danh sách Banner";
    ViewBag.url_back = "/admins/slides";
    Layout = "~/Areas/Admins/Views/Shared/_LayoutAdmins.cshtml";
    var stt = 0;
}

<style>
    .input-group-prepend, .input-group-prepend > span {
        width: 120px !important;
    }

    .form-group label {
        cursor: pointer;
    }

    h6 span {
        color: #495057;
        font-size: 1.1rem;
        font-weight: 400;
        line-height: 1.2;
        padding: 2rem 0rem;
    }
</style>
<div class="show-table">
    <div class="container-fluid objInfor pl-3 pr-3">
        <div class="row mb-1 span-img objProduct">
            <input type="hidden" name="ID" value="0" id="ID" />
            <div class="col-md-9 mb-1">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Mã sản phẩm</span>
                    </div>
                    <input type="text" name="Code" class="form-control" id="code" maxlength="10">
                </div>
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Tiêu đề bài viết</span>
                    </div>
                    <input type="text" name="Title" class="form-control" id="title" maxlength="100" progess-value="progess1">
                </div>

                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Tiêu đề Sub</span>
                    </div>
                    <input type="text" name="Sub_Title" class="form-control" id="sub_title" maxlength="100" progess-value="">
                </div>



                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">URL</span>
                    </div>
                    <input type="text" name="Slug" class="form-control" maxlength="280" id="slug" progess-value="progess1">
                </div>

                <div class="progress mt-0 mb-3">
                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                         data-status="low" id="progess1" role="progressbar"
                         style="width: 25%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="280">
                        <span data-progress="progess1">25%</span>
                    </div>
                </div>

                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text">Order</span>
                    </div>
                    <input type="number" name="Order" class="form-control" maxlength="280" id="orders">
                </div>

            </div>
            <div class="col-md-3 mb-1">
                <h6 class="input-group-text">Ảnh đại diện</h6>
                <input type="hidden" name="Image" value="~/Content/assets/images/festivalmarket/no-image-available-thumb(1349x760-crop).jpg" id="image" />
                <img src="~/Content/assets/images/festivalmarket/no-image-available-thumb(1349x760-crop).jpg" class="img-size" title="Cập nhật" id="show-img" />
            </div>
        </div>

        <div class="row mb-3 objProduct textEditor">
            <div class="col-md-9 mb-3">

                <div>
                    <h6 class=" mb-1"><span>Nội dung chi tiết</span></h6>
                    <textarea name="Notes" id="product-content" class="ckeditor"></textarea>
                </div>
            </div>
            @*<div class="col-md-3 mb-3">
                    <div class="mb-3">
                        <button class="addImage">Thêm ảnh</button>
                        <hr />
                        <div class="list-img d-flex flex-wrap">

                        </div>
                    </div>
                </div>*@
        </div>
        <div class="form-group">
            <label class="font-weight-bold mr-2">Trạng thái </label>
            <input type="radio" name="IsActive" id="s1" value="1" checked /><label class="ml-2 mr-5" for="s1">Hiển thị</label>
            <input type="radio" name="IsActive" id="s2" value="2" /><label class="ml-2" for="s2">Lưu tạm</label>
        </div>

        <div class="container-fluid">
            <div class="row mb-3">
                <div class="col-md-12 text-right mr-0 pr-0 mt-1 mb-5 modal-footer">
                    <button type="button" class="btn btn btn-red" onclick="backClick();"><i class="fas fa-reply-all"></i> Bỏ qua</button>
                    <button type="button" class="btn btn-green btnSave" onclick=""> <i class="far fa-save"></i> Ghi lại</button>
                </div>
            </div>
        </div>


    </div>


</div>


<div hidden class="objProduct">
    <div class="input-group res-size-21 mb-3 mr-2 w-50">
        <div class="input-group-prepend">
            <span class="input-group-text">Ngày tạo</span>
        </div>
        <input type="date" name="CreatedDate" id="ngay-tao" value="@DateTime.Now.ToString("yyyy-MM-dd")" class="form-control" />
    </div>
    <div class="input-group res-size-21 mb-3 w-50">
        <div class="input-group-prepend">
            <span class="input-group-text">Ngày sửa</span>
        </div>
        <input type="date" name="ModifiedDate" id="ngay-sua" value="@DateTime.Now.ToString("yyyy-MM-dd")" class="form-control" />
    </div>
</div>
@section scripts{
    <script src="~/Content/ckfinder/ckfinder.js"></script>
    <script>

        function backClick() {
            location.href = "/admins/slide";
        }
        $(document).ready(function () {

            CKEDITOR.replace('product-content', {
                toolbar: [
                    { name: 'basicstyles', items: ['Bold', 'Italic',] },
                    { name: 'styles', items: ['Styles', 'Format'] },
                    { name: 'paragraph', groups: ['list', 'indent', 'blocks', 'align', 'bidi'], items: ['NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote', '-', 'JustifyLeft', 'JustifyCenter', 'JustifyRight', 'JustifyBlock', '-', 'BidiLtr', 'BidiRtl'] },
                    { name: 'links', items: ['Link', 'Unlink', 'Anchor'] },
                    { name: 'tools', items: ['Maximize', 'ShowBlocks'] }
                ],
                height: 100
            });
            addData();
        });
        function addData() {
            $(document).on('click', '.btnSave', function () {
                let slide = new Object();

                $('.objProduct input[type="text"],.objProduct input[type="number"], .objProduct input[type="hidden"], .objProduct input[type="date"]').each(function () {
                    slide[$(this).attr('name')] = $(this).val();
                });
                $('.objProduct select').each(function () {
                    slide[$(this).attr('name')] = $(this).val();
                });
                $('.textEditor textarea').each(function () {
                    let id = $(this).attr('id');
                    slide[$(this).attr('name')] = CKEDITOR.instances[id].getData();
                });

                $(' input[name="IsActive"]:checked').each(function () {
                    slide.IsActive = $(this).val();
                });

                $('.list-img img').each(function () {
                    let img = new Object();
                    img.Image = $(this).attr('src');
                    images.push(img);
                })

                console.log(slide);
                $.ajax({
                    url: '/Admins/Slide/AddOrUpdate',
                    type: 'POST',
                    dataType: 'json',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        eve: slide,

                    }),
                    beforeSend: function () {

                    },
                    success: function (res) {
                        let id = $('#ID').val();
                        if (id == 0) {
                            msg0 = "Thêm mới dữ liệu thành công.";
                            msg1 = "Đã xảy ra lỗi khi thêm mới dữ liệu";
                        } else {
                            msg0 = 'Sửa đổi dữ liệu thành công';
                            msg1 = 'Đã xảy ra lỗi khi sửa đổi dữ liệu';
                        }
                        if (res != 0) {
                            swal({
                                title: "Thông báo",
                                text: msg0,
                                icon: "success",
                                dangerMode: true,
                            }).then(() => {

                            });
                        } else {
                            swal({
                                title: "Thông báo",
                                text: msg1,
                                icon: "warning",
                                dangerMode: true,
                            });
                        }
                        console.log(res);
                    },
                    error: function () {

                    },
                    complete: function () {

                    }
                })
            });
        }
        function addImage() {
            $('.addImage').click(function () {
                let finder = new CKFinder();
                finder.selectActionFunction = function (fileUrl) {
                    let row = `<div class="img">
                                    <img src="${fileUrl}" alt="hình ảnh mô tả sản phẩm" />
                                    <i class="fas fa-trash-alt"></i>
                                </div>`;
                    $('.list-img').append(row);
                };
                finder.popup();
            });
            $(document).on('click', '.list-img img', function () {
                let finder = new CKFinder();
                let img = this;
                finder.selectActionFunction = function (fileUrl) {
                    console.log(img);
                    $(img).attr('src', fileUrl);
                };
                finder.popup();
            })
        }
        addImage();
        ChooseImage();
        deleteImage();
        function ChooseImage() {
            $('#show-img').click(function () {
                let finder = new CKFinder();
                let img = this;
                finder.selectActionFunction = function (fileUrl) {
                    console.log(fileUrl);
                    $(img).attr('src', fileUrl);
                    $('#image').val(fileUrl);
                };
                finder.popup();
            });
        }
        function deleteImage() {
            $(document).on('click', '.list-img .img i', function () {
                $(this).parent('.img').remove();
            })
        }
    </script>

    <script src="~/Scripts/common.js"></script>
    <script src="~/Scripts/checkSeo.js"></script>
    <script>
        $(document).ready(function () {
            $('#title').bind("change keyup", function () {
                let val = $(this).val();
                $('#slug').val(titleChange(val));
                $('#show-url').text(titleChange(val));
                $('#seo-title').val(val.trim());
                $('#show-meta-title').text(val.trim());

                selectSEO('slug', 'show-url', 100);
            });


        });
    </script>

}
